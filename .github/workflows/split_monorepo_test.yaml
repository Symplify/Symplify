name: Split monorepo test

on:
    pull_request: null
    push:
        branches:
            - master

jobs:
    tests:
        runs-on: ubuntu-latest
        steps:
            -   uses: actions/checkout@v2
            # required for "git tag" presence for monorepo-builder split and changelog-linker git tags resolver; default is 1
                with:
                    fetch-depth: 10000

            # see https://github.com/shivammathur/setup-php
            -   uses: shivammathur/setup-php@v1
                with:
                    php-version: 7.3
                    coverage: none

            -   run: composer install --no-progress

            -   run: mkdir -p /tmp/test-monorepo
            -   run: .github/scripts/prepare-test-monorepo.sh /tmp/test-monorepo-split
            -   run: (MBSCRIPT=`readlink -f packages/monorepo-builder-bin/monorepo-builder` && cd /tmp/test-monorepo-split/top && $MBSCRIPT split --verbose)
